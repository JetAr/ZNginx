<HTML>
<HEAD>
<TITLE>Phttpd - Writing .map files</TITLE>
</HEAD>
<BODY>
<H2>Writing .map files</H2>

The primary use of <EM>.map</EM> files is to handle the requests
generated by clients when using the <EM>ISMAP</EM> HTML feature
to create clickable pictures.

<H3>Example</H3>

The following image is an image map. Click anywhere in the picture and see
where it takes you. After each time, go back and click somewhere else. Try out
the rectangle, the triangle, etc. Depending on where you clicked, the browser
will retrieve different documents.

<p align=center><a href="test.map"><img alt="Image map" src="images/test.gif" ismap></a></p>

<H3>What happens behind the scenes</H3>

When you click on such a picture your client will generate a
request to the server with the pixel coordinates appended to
the URL specified. For example, suppose your HTML document contained the
following bit of code:

<PRE>
&lt;A HREF="test.map"&gt;&lt;IMG ALT="Image map" SRC="images/test.gif" ISMAP&gt;&lt;/A&gt;
</PRE>

and the user were to click on the image, the browser might generate a request
like this:

<PRE>
	http://www.signum.se/phttpd/docs/user/map/test.map?123,454
</PRE>

That is, it follows the link as it would normally, but because of the ISMAP
attribute of the IMG element, the coordinates of the click are appended to the
URL.

<P>

In response to this, the server looks at the <code>test.map</code> file and
sends back a redirect to the URL corresponding to the coordinates clicked. The
browser then goes out and retrieves the document. If no URL is associated with
the coordinates, the server sends back a special "No response" code and the
browser does nothing.

<H3>Setting up your own image map</H3>

First, you need to create a text file containing the map coordinates and the
corresponding URLs. In the example above, the map file looked like this:

<PRE>
rect 	rect.html	10,70,90,90		# this is a rectangle
circle  circ.html	30,50,45,50		# this is a circle
poly    tri.html 	55,65,73,41,90,65	# this is a triangle
point   left.html	30,18			# this is the left point
point   right.html 	73,18			# this is the right point
</PRE>

Each line defines a "hot zone" in the image. The coordinate system has its
origin in the lower left corner (i.e. (0,0) is the left most pixel in the
bottom row). There are four kinds of hot zones that can be defined:
Rectangles, circles, polygons and points. In addition, one can define a
default URL which is to be applied if no other hot zone applies.

<P>

Once you have created the map, you point to the image file and this
<EM>.map</EM> file in your HTML document, by writing something like this:

<PRE>
	This is a clickable image:
	&lt;P&gt;
	&lt;A HREF="sample.map"&gt;
	&lt;IMG SRC="fine-picture.gif" ISMAP&gt;
	&lt/A&gt;
</PRE>

<H4>Format of the map file</H4>

The server looks at the file line by line and checks if the coordinates match
the specified hot zone. The first line that matches is used, unless it
specifies the default. Everything following a `#' up to the end of the line is
ignored and can be used as a comment. If no line matches, the default URL is
used, or if there is no default, a "No response" status code is
generated.

<P>

Both the NCSA server and the CERN server included image map programs in their
distribution since early on, but they each use different formats for their map
files. Since both formats are widely used and since tools exist which can
create maps in either format, the map module was programmed to recognize both
formats.

<P>

The map lines can appear in either of these formats:

<dl>
  <dt> NCSA
  <dd> <var>shape</var> <var>URL</var> <var>coordinates</var>
  <dt> CERN
  <dd> <var>shape</var> <var>coordinates</var> <var>URL</var>
</dl>

In addition, the default URL can be specified as

<blockquote><code>default</code> <var>URL</var></blockquote>

<var>shape</var> defines the shape of the hot zone and can be one of
<code>rect</code>, <code>circle</code>, <code>poly</code>, or
<code>point</code>. The coordinates are a comma separated list of numbers. In
the CERN format, coordinate pairs are delimited by parentheses. These are the
formats for the various shapes:

<pre><table align=center><tr><td>          </td><th>NCSA             </th><th>CERN
</th></tr><tr><th align=left>rect      </th><td>x1,y1 x2,y2      </td><td>(x1,y1) (x2,y2)
</td></tr><tr><th align=left>circle    </th><td>x1,y1 x2,y2      </td><td>(x1,y1) r
</td></tr><tr><th align=left>poly      </th><td>x1,y1 x2,y2 ...  </td><td>(x1,y1) (x2,y2) ...
</td></tr><tr><th align=left>point     </th><td>x1,y1            </td><td>(x1,y1)
</td></tr></table></pre>

Notes:
<ol>
  <li> For rectangles, the two coordinate pairs determine the location of two
       diagonally opposed corners.
  <li> In the NCSA format, circles are defined by the center point (x1,y1) and
       a point on the circle itself (x2,y2). In the CERN format, circles are
       defined by the center point (x1,y1) and the radius (r).
  <li> Polygons are automatically closed if the last point is not the same as
       the first point.
  <li> Points do not actually define hot zones, but act as default values. If
       no other hot zone matches, the point that is closest to the user's
       click is used. Points always override any default URL.
</ol>


<H3>What if the browser does not support image maps?</H3>

There may be a number of reasons why a browser does not support the ISMAP
attribute in images. The most common one is that the browser does not display
graphics. If a user follows the link to the map file using such a browser, a
request is issued without or with invalid coordinates. In such cases, the
server attempts to display the map as a menu of URLs. This should allow users
of text-based systems or blind users to make use of image maps as well. Here
is an example of an invalid map URL:

<BLOCKQUOTE><A HREF="test.map">test.map</A></BLOCKQUOTE>

Try to follow the link and see what happens. You should get a textual display
of the map.

</BODY>
</HTML>
