<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,0:HeaderFooterSprite,0:Header.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=C9973DA951AE6202C9B348379A1BE49D" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/a7d1e078-8570-47da-a87b-ff462dfc958dCombined.css,0:HeaderFooterSprite,0:Footer.NonMtps,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;hashKey=F576C687BC536B84D6E5B3246EE39B49" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>C++ UTF-8 Conversion Helpers</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>C++ UTF-8 Conversion Helpers</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Win32, C++, Windows SDK, STL
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            Unicode
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">10/29/2011</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/C-UTF-8-Conversion-Helpers-22c0a664">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<h1>Introduction</h1>
<p><span style="font-size:small">There are several encodings for Unicode; UTF-16 is the one used by Windows API's. Another important encoding is UTF-8, which is widely used for text travelling across the Internet. Win32 Platform SDK offers a couple of API's
 to convert between these two encodings: <a title="MultiByteToWideChar() MSDN documentation" href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd319072(v=vs.85).aspx" >
MultiByteToWideChar</a>,&nbsp;which can be used to convert from UTF-8 to UTF-16, and
<a title="WideCharToMultiByte() MSDN documentation" href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd374130(v=vs.85).aspx" >
WideCharToMultiByte</a>,&nbsp;which can be used for the opposite conversion.</span></p>
<p><span style="font-size:small">However, using these raw APIs is not very convenient.
<a title="ATL Conversion Helpers" href="http://msdn.microsoft.com/en-us/library/87zae4a3(v=vs.80).aspx" >
Helper classes</a> are already available for code using ATL. Instead, in this sample, C&#43;&#43; conversion functions using
<strong>pure Win32 SDK and STL</strong> are presented.&nbsp;</span></p>
<p><span style="font-size:x-small"><br>
</span></p>
<p><em>&nbsp;</em><span style="font-size:20px; font-weight:bold">Building the Sample</span></p>
<p><span style="font-size:small">This sample uses pure Win32 SDK and STL, so it can be built also from the Express Edition of Visual Studio.</span></p>
<p><em><br>
</em></p>
<p><span style="font-size:20px; font-weight:bold">Description</span></p>
<p><span style="font-size:small">This sample implements some Unicode conversion helper functions, which wrap the calls to MultiByteToWideChar and WideCharToMultiByte raw API's. Error checking, accomodating buffers for the conversions, etc. are all hidden inside
 the body of these helper functions. The user just passes STL strings as input, and gets converted STL strings back as output. Errors during conversion are signaled throwing an
<em>ad hoc</em> C&#43;&#43; exception class (with some details about the conversion and error code packed inside).</span></p>
<p><span style="font-size:small">All these helpers are embedded in a C&#43;&#43; namespace to make it easy to integrate this module in bigger projects.</span></p>
<p><span style="font-size:small">To convert a Unicode string from UTF-16 to UTF-8 (for example to send it over the Internet), a C&#43;&#43; code like this can be used:</span></p>
<p><em><br>
</em></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C&#43;&#43;</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">cplusplus</span>
<pre class="hidden">// Source UTF-16 string
wstring utf16;
   // ...

// Get Unicode UTF-8 string from an UTF-16 string
string utf8 = UTF8FromUTF16(utf16);

// Can catch an utf8_conversion_error 
// C&#43;&#43; exception to detect errors 
// occurred during the conversion.</pre>
<div class="preview">
<pre class="cplusplus"><span class="cpp__com">//&nbsp;Source&nbsp;UTF-16&nbsp;string</span>&nbsp;
wstring&nbsp;utf16;&nbsp;
&nbsp;&nbsp;&nbsp;<span class="cpp__com">//&nbsp;...</span>&nbsp;
&nbsp;
<span class="cpp__com">//&nbsp;Get&nbsp;Unicode&nbsp;UTF-8&nbsp;string&nbsp;from&nbsp;an&nbsp;UTF-16&nbsp;string</span>&nbsp;
<span class="cpp__datatype">string</span>&nbsp;utf8&nbsp;=&nbsp;UTF8FromUTF16(utf16);&nbsp;
&nbsp;
<span class="cpp__com">//&nbsp;Can&nbsp;catch&nbsp;an&nbsp;utf8_conversion_error&nbsp;</span>&nbsp;
<span class="cpp__com">//&nbsp;C&#43;&#43;&nbsp;exception&nbsp;to&nbsp;detect&nbsp;errors&nbsp;</span>&nbsp;
<span class="cpp__com">//&nbsp;occurred&nbsp;during&nbsp;the&nbsp;conversion.</span></pre>
</div>
</div>
</div>
<p><span style="font-size:small">UTF-8 strings are stored in <em>std::string</em>; UTF-16 strings are stored in
<em>std::wstring</em>.</span></p>
<p><span style="font-size:small">There are also overloads of the conversion functions that take raw C strings as input (to avoid conversions from raw C strings to temporary STL strings).</span></p>
<p><span style="font-size:small">Conversion errors are signaled using the <strong>
<em>utf8_conversion_error</em></strong> C&#43;&#43; exception class, which is integrated in the C&#43;&#43; standard exception hierarchy (in particular, it derives from
<em>std::runtime_error</em>).</span></p>
<p><span style="font-size:x-small"><br>
</span></p>
<h1><span>Source Code Files</span></h1>
<ul>
<li><span style="font-size:small"><em><strong>utf8conv.h</strong>&nbsp;</em>- this is the public header file of the conversion helper module.</span>
</li><li><span style="font-size:small"><em><em><strong>utf8conv_inl.h</strong>&nbsp;</em></em>- this file contains inline implementations of the conversion helper module functions and methods (it is included by the previous header).</span>
</li><li><span style="font-size:small"><em><em>test.cpp </em></em>- this file contains some tests (in console mode).</span>
</li></ul>
<h1>More Information</h1>
<p><span style="font-size:small">For more details, see&nbsp;<a title="Conversion between Unicode UTF-8 and UTF-16 with STL strings" href="http://msmvps.com/blogs/gdicanio/archive/2011/02/04/conversion-between-unicode-utf-8-and-utf-16-with-stl-strings.aspx" >Conversion
 between Unicode UTF-8 and UTF-16 with STL strings</a> blog post.</span></p>
<p><em><br>
</em></p>

</div>


    </div>
</body>
</html>
